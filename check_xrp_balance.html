<!doctype html>
<html lang="eng">
    <head>
        <meta charset="utf-8">

        <title>Check XRP Balance</title>

		<style>
			input[type=text] {
				width:50%;
				padding:5px;
			}
		</style>
		
		<!--
		
			A modern JavaScript utility library that is a dependency of the RippleAPI
			https://lodash.com/ You'll need to download the full build, minified and then change the file name to include the version number.
			
			---------------------------
			Checksum information
			---------------------------
			Name: lodash-4.17.15-min.js
			Size: 73261 bytes
			SHA256: 55E35A1415438685F71FE809DFB0E94FF9D3B994DD8D8AE8F7206BB878D59A84
			
			Confirm you are using the original, unchanged file direct from Lodash by double checking the SHA256 hash of the lodash-??.??.??-min.js file.

		-->
		<script src="assets/lodash-4.17.15-min.js"></script>
		
		<!--
		
			A JavaScript API for interacting with the XRP Ledger in Node.js AND/OR a browser
			https://github.com/ripple/ripple-lib/releases 
		
			---------------------------
			Checksum information
			---------------------------
			Name: ripple-1.3.3-min.js
			Size: 583448 bytes
			SHA256: B870C074ECC7BD1A7026293331E5A7B794CD2BF59B39A36FA506AF7DDDBF5B53
			
			Confirm you are using the original, unchanged file direct from Ripple by double checking the SHA256 hash of the ripple-??.??.??-min.js file.

		-->
		<script src="assets/ripple-1.3.3-min.js"></script>
    </head>
	
    <body class="" style="margin:20px 20px 20px 20px; font-family:consolas, 'courier new', courier, monospace;">
	
        <h1>Check XRP Balance</h1>
		
		<p>Refresh the page to restart the process.</p>
		
		<br>
		
		<label id="inp_public_address_label" for="inp_public_address" class="" style="">XRP Public Address</label>
		<input id="inp_public_address" name="inp_public_address" type="text" class="" style="" maxlength="35" placeholder="Enter your 'XRP Public Address' here." value="">

		<div style="clear:both;"></div>
		<br>
		
		<label id="inp_balance_label" for="inp_balance" class="" style="display:none;">XRP Balance</label>
		<input id="inp_balance" name="inp_balance" type="text" class="" style="background-color:lightgray; display:none;" maxlength="100" placeholder="XRP balance appears here." value="" readonly>

		<div style="clear:both;"></div>
		<br>

		<script>
			function fun_CheckBalance() {
				"use strict";
				
				// FOR TESTING PURPOSES ONLY.
				// XRP Public Address randomly taken from the Ripple Account Explorer = r3kmLJN5D28dHuH8vZNUZpMC43pEHpaocV
				
				const api = new ripple.RippleAPI({
					server: 'wss://s2.ripple.com' // s2 is a Full-history server cluster.
				});
				
				var ele_inp_public_address = document.getElementById('inp_public_address');
				var str_public_address = "";
				var arr_balances = [];
				var int_index = 0;
				var flo_balance = 0.000000;
				
				// Check that the entered address is a valid XRP public address.
				str_public_address = ele_inp_public_address.value;
				if (api.isValidAddress(str_public_address) == false) {
					alert("You need to enter a valid 'XRP Public Address' before you can check its balance.");
					return; // Exit the function.
				}

				api.connect().then(() => {
					api.getBalances(str_public_address).then(arr_balances => {
					
						// Returns an array of objects.
						// Example:
						//	[
						//	  {
						//		"value": "7578.666662",
						//		"currency": "XRP"
						//	  },
						//	  {
						//		"value": "89",
						//		"currency": "ASP",
						//		"counterparty": "r3vi7mWxru9rJCxETCyA1CHvzL96eZWx5z"
						//	  },
						//	  {
						//		"value": "20",
						//		"currency": "USD",
						//		"counterparty": "rEhDDUUNxpXgEHVJtC2cjXAgyx5VCFxdMF"
						//	  }
						//	]

						int_index = arr_balances.findIndex(x => x.currency == "XRP");
						flo_balance = parseFloat(arr_balances[int_index].value);
						
						// Update the field.
						document.getElementById('inp_balance').value = flo_balance;						
						
						// Show the Balance field.
						document.getElementById('inp_balance_label').style.display = '';
						document.getElementById('inp_balance').style.display = '';
					});
				});
				
				// Make the 'Public Address' field read only.
				ele_inp_public_address.readOnly = true;
				ele_inp_public_address.style.backgroundColor = 'lightgray';

				// Hide the 'Check' button.
				document.getElementById('but_check_balance').style.display = 'none';
			}
		</script>
		<button id="but_check_balance" type="button" onclick="fun_CheckBalance();" class="" style="">
			Check Balance
		</button>

    </body>
</html>